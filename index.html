<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3DGS Viewer (mkkellogg)</title>
    <style>
        body { margin: 0; background-color: #000; overflow: hidden; }
        #container { width: 100vw; height: 100vh; }
        .loading {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: white; font-family: sans-serif;
        }
    </style>
</head>
<body>
    <button id="ar-button">ВОЙТИ В AR</button>
    <div id="container"></div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://esm.run/three",
            "@mkkellogg/gaussian-splats-3d": "https://esm.run/@mkkellogg/gaussian-splats-3d"
        }
    }
    </script>

    <script type="module">
        import * as GaussianSplats3D from '@mkkellogg/gaussian-splats-3d';

        // Настройки вьювера
        const viewer = new GaussianSplats3D.Viewer({
            'cameraUp': [0, -1, 0],
            'initialScenePosition': [0, 0, 2], // Отодвигаем камеру назад от центра
            'initialSceneLookAt': [0, 0, 0],
            'scale': [10, 10, 10], 
            'sphericalHarmonicsDegree': 2,
            'rootElement': document.getElementById('container'),
            'sharedMemoryForWorkers': false  
        });

        // Загрузка файла (замени 'model.splat' на свой файл .ply или .splat)
        viewer.addSplatScene('./model.splat', {
            'showLoadingUI': true,
            'progressiveLoad': true
        })
        .then(() => {
            viewer.start();
            
            if (navigator.xr) {
                navigator.xr.isSessionSupported('immersive-ar').then((supported) => {
                    if (supported) {
                        const btn = document.getElementById('ar-button');
                        btn.style.display = 'block';
                        btn.addEventListener('click', () => {
                            // Запуск AR сессии через встроенный метод библиотеки
                            viewer.enterAR();
                        });
                    }
                });
            }
        })
        .catch((err) => {
            console.error('Ошибка загрузки:', err);
        });
    </script>

</body>
</html>
